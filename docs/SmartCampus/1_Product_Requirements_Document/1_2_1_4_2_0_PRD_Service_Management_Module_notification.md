System: ### 智慧园区通知公告功能需求与设计（整合版）

以下是将您提供的**通知公告需求**（P0、P1优先级功能）提取并整合到现有需求与设计文档中的结果。提取的内容剔除了P2优先级功能（如通知公告模板管理），并与智慧园区轻量需求相结合，确保功能覆盖全面、设计简洁、灵活可扩展。设计继续采用**状态与权限挂钩**模型，起草、审核、发布、管理、归档作为独立权限，支持一人或多人分配。

---

## 一、需求概述

### 1. 业务背景

智慧园区的通知公告功能用于发布园区通知（如活动、维护、政策、紧急通知），面向物业管理者、居民、企业用户等。功能需简单直观，适合小型团队，同时具备灵活性以适应未来规模扩展或流程变化。

### 2. 核心需求

- **流程**：通知公告从起草到归档，经历以下状态：草稿 → 待审核 → 待发布 → 已发布 → 已过期/已取消发布 → 档案。
- **权限**：起草、审核、发布、管理、归档作为独立权限，灵活分配给一人或多人。状态与权限挂钩，每个状态对应特定操作（如待发布状态对应发布权限）。
- **功能**：
  - **管理**：支持新增、删除、查询、修改、审核、发布、置顶。
  - **创建**：设置标题、正文、公开范围（全园区、特定企业、角色）、类型（普通、政策、活动、紧急）、重要性（普通、重要、紧急）、是否需确认接收、附件上传。
  - **审核**：根据重要性分级审核（普通：单级，重要：双级，紧急：快速通道）。
  - **发布**：支持即时和定时发布，多渠道推送（站内信、App推送、短信）。
  - **统计**：统计阅读情况（阅读量、阅读率、按企业分析），支持确认接收统计。
  - **分类**：按类型和重要性分类管理，支持自定义类型。
- **用户体验**：界面简洁，动态显示权限相关操作按钮，支持模糊搜索、多维度筛选（类型、状态、时间、关键词）和按阅读率排序。
- **扩展性**：支持新增状态、权限、类型，改动成本低。

### 3. 权限与状态映射

| 状态         | 对应权限 | 可执行操作                              |
|--------------|----------|-----------------------------------------|
| 草稿         | draft    | 编辑、保存、提交审核、删除              |
| 待审核       | audit    | 通过、驳回、建议修改                    |
| 待发布       | publish  | 预览、发布、撤回                        |
| 已发布       | manage   | 置顶、取消置顶、延期、取消发布、删除、统计 |
| 已过期       | archive  | 查询、归档                              |
| 已取消发布   | archive  | 查询、归档                              |
| 档案         | archive  | 查询、解档                              |

- **权限说明**：
  - `draft`：创建和编辑草稿。
  - `audit`：审核草稿（通过、驳回、建议修改）。
  - `publish`：发布或撤回待发布公告。
  - `manage`：管理已发布公告（置顶、延期、取消发布、删除、统计）。
  - `archive`：归档、解档、查询归档公告.
- **管理员**：拥有所有权限，执行高危操作（如删除、解档）。
- **分配方式**：权限可分配给一人（如一人全包）或多人（如多人审核）。

### 4. 通知公告流程说明

#### 主流程

起草 → 审核 → 发布 → 管理 → 归档

#### 各阶段说明

1. **起草**
   - **输入状态**：草稿
   - **操作**：
     - 编辑：设置标题（≤50字，必填）、正文（富文本）、公开范围（全园区、特定企业、角色）、类型（普通、政策、活动、紧急）、重要性（普通、重要、紧急）、是否需确认接收、确认截止时间、附件（单个≤20MB，总≤50MB）。
     - 保存为草稿：保留草稿状态。
     - 提交审核：进入待审核状态。
     - 删除：移至回收站（可恢复）。
   - **输出状态**：
     - 待审核（提交审核）
     - 草稿（保存、驳回、撤回）
   - **权限**：draft
   - **通知**：提交审核时通知有 audit 权限的用户，包含类型和重要性。
   - **备注**：
     - 支持预览终端显示效果。
     - 重要/紧急通知自动设置确认机制。
     - 驳回/撤回后可重新编辑。
     - 删除需二次 confirmation，回收站保留30天.

2. **审核**
   - **输入状态**：待审核
   - **操作**：
     - 通过：进入待发布状态。
     - 驳回：返回草稿状态，附原因。
     - 建议修改：返回草稿状态，附建议。
   - **输出状态**：
     - 待发布（通过）
     - 草稿（驳回、建议修改）
   - **权限**：audit
   - **通知**：
     - 通过时通知有 publish 权限的用户和起草人。
     - 驳回/建议修改时通知起草人。
   - **备注**：
     - 审核流程根据重要性：
       - 普通通知：单级审核。
       - 重要通知：双级审核（运营主管→管理员）。
       - 紧急通知：快速审核（高优先级）。
     - 审核检查文字、合规性、敏感词、范围合理性。
     - 超时（24小时）自动提醒。
     - 记录审核日志，支持沟通反馈。

3. **发布**
   - **输入状态**：待发布
   - **操作**：
     - 预览：查看发布效果。
     - 发布：即时或定时发布，初始化查看/确认记录。
     - 撤回：返回草稿状态，附原因。
   - **输出状态**：
     - 已发布（发布）
     - 草稿（撤回）
   - **权限**：publish
   - **通知**：
     - 发布时根据公开范围推送（站内信、App推送、短信），若需确认接收，提示确认。
     - 撤回时通知起草人和有 audit 权限的用户。
   - **备注**：
     - 推送渠道根据重要性：
       - 普通：站内信。
       - 重要：站内信+App推送。
       - 紧急：站内信+App推送+短信。
     - 发布前检查附件可访问性。
     - 发布/撤回需二次 confirmation。
     - 撤回需高级权限。

4. **管理**
   - **输入状态**：已发布
   - **操作**：
     - 置顶：置于列表顶部。
     - 取消置顶：取消置顶。
     - 延期：延长有效期。
     - 取消发布：进入已取消发布状态。
     - 删除：移至回收站。
     - 统计：查看阅读量/率、确认情况，按企业分析。
   - **输出状态**：
     - 已过期（自动到期）
     - 已取消发布（手动取消）
     - 档案（手动归档）
   - **权限**：manage
   - **通知**：
     - 置顶/取消发布/延期时通知相关人员。
     - 自动过期时通知有 archive 权限的用户。
   - **备注**：
     - 有效期默认7天，到期转为已过期。
     - 删除需二次 confirmation。
     - 统计支持按企业分析，显示未读/未确认名单。

5. **归档**
   - **输入状态**：已过期、已取消发布
   - **操作**：
     - 查询：查看归档公告。
     - 归档：手动归档。
     - 解档：恢复至草稿状态，附原因。
   - **输出状态**：
     - 档案（默认）
     - 草稿（解档）
   - **权限**：archive
   - **通知**：解档时通知起草人和有 archive 权限的用户.
   - **备注**：
     - 解档需审批，仅限特殊场景。
     - 归档公告不可修改。

#### 状态流转图

```
┌─────────┐      ┌─────────┐      ┌─────────┐      ┌─────────┐
│  草稿   │─────>│ 待审核  │─────>│ 待发布  │─────>│ 已发布  │
└─────────┘      └─────────┘      └─────────┘      └─────────┘
    │                 │                 ▲                 │
    │                 ▼                 │                 ▼
    │            ┌─────────┐           │            ┌─────────┐
    └───────────>│  驳回   │───────────┘            │ 已过期  │
                 └─────────┘                        └─────────┘
                       ▲                                 │
                       │                                 ▼
                 ┌─────────┐                        ┌─────────┐
                 │已取消发布│──────────────────────>│  档案   │
                 └─────────┘                        └─────────┘
                       ▲                                 ▲
                       └─────────────────────────────────┘
```

#### 附加要求

1. **权限控制**：动态分配权限，支持一人多权限或多人共享权限。
2. **通知机制**：状态转换触发通知（站内信、App推送、短信）；重要通知提醒未确认用户。
3. **历史记录与审计**：记录操作日志，保存6个月。
4. **异常处理**：
   - 审核超时（24小时）：提醒审核人，超期通知管理员。
   - 系统故障：状态转换失败时回滚。
   - 删除/解档：需二次 confirmation，记录日志.
5. **回收站**：删除公告保留30天，支持恢复至草稿.
6. **自动过期**：有效期（默认7天）到期转为已过期，3天后自动归档.
7. **阅读与确认**：
   - 统计阅读量、阅读率、按企业分析，显示未读名单。
   - 重要通知需确认，设置截止时间，自动提醒未确认用户（系统提醒→企业管理员督促→电话跟进）。
8. **分类与筛选**：
   - 支持按类型（普通、政策、活动、紧急）、重要性（普通、重要、紧急）分类。
   - 支持模糊搜索（标题、内容）、多维度筛选（类型、状态、时间、关键词）、按阅读率排序。